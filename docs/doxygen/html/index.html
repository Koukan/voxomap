<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Voxomap: Library Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Voxomap
   </div>
   <div id="projectbrief">A C++11 voxel container.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Library Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Introduction</h1>
<p>Voxomap is a container of voxels, it's a C++11 header only library. It was build to be used like a std container, it's templated on user data and it's possible to browse it with iterators.</p>
<p>The container is based on an octree and uses a structure in leaves of the tree to improve performance and memory footprint.</p>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Octree Representation</h1>
<p>The library is based on an <a href="https://en.wikipedia.org/wiki/Octree">octree</a>, it's a tree data structure in which each internal node has exactly eight children. Octrees are used to partition a three-dimensional space by recursively subdividing it into eight octants/nodes. The bottom level of the octree consists of leaf nodes that contain the voxels (user data). Octrees are the three-dimensional analog of <a href="https://en.wikipedia.org/wiki/Quadtree">quadtrees</a>. <br  />
 </p><div class="image">
<img src="octree.png" alt="" width="600px"/>
</div>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Voxel Container Representation</h1>
<p>The leaf nodes of the VoxelOctree, that have size of 8, contain voxel container. A voxel container is a structure that contains voxels, it can contain 8x8x8(512) voxels. The voxel container fills all its octants/nodes, so like its container, it is axis aligned. The library allows to implement different type of voxel container. There are two implementations, but it's easy to create a new one that will better suit your needs. <br  />
 </p><div class="image">
<img src="voxel_octree.png" alt="" width="600px"/>
</div>
<p> This structure exists for improved performance and memory. This mixture between octree and array allows to take advantage of both structure without taking their disadvantages. Indeed, an octree has advantage to be dynamic and to not store empty space but can take lot of memory to store all its nodes and it's heavy to go through. An array, meanwhile, has advantage to store only user information (no nodes) and it's fast to go through but stores the empty space and is difficult to grow.</p>
<p>This structure doesn't store empty space (when no voxels, no voxel containers and no nodes), uses less nodes (voxel container inside node of size 8), it's easy to grow (advantage of a tree) and the performance for going through are very good (not so far from an array).</p>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md3"></a>
ArrayContainer</h2>
<p>This structure is based on a fixed size 3D array that contains the user data. It's a very simple structure that is useful for high density of voxels.</p><ul>
<li>Advantage<ul>
<li>Good global performances</li>
</ul>
</li>
<li>Disadvantage<ul>
<li>Big memory footprint (RAM and serialized), same memory footprint with 1 or 512 voxels.</li>
</ul>
</li>
</ul>
<p><b>Warning</b>: For use this structure, the user data structure must override the boolean operator to know if it's an empty voxel or not.</p>
<div class="image">
<img src="array_container.png" alt=""/>
</div>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md4"></a>
SparseContainer</h2>
<p>This structure is a mix between a fixed size 3D array (like in <a class="el" href="structvoxomap_1_1_array_container.html">ArrayContainer</a>) and a dynamic array. Useful for little density of voxels.</p><ul>
<li>Advantages:<ul>
<li>Good access/update performance (~= ArrayContainer)</li>
<li>Small memory footprint</li>
</ul>
</li>
<li>Disadvantages:<ul>
<li>Less performant on add/remove than the ArrayContainer</li>
<li>Bigger memory footprint than the ArrayContainer when high density</li>
</ul>
</li>
</ul>
<p><br  />
 The container uses 3 containers:</p><ul>
<li>(A) fixed size 3D array of size 8x8x8 that contains ids on (B), initialized to 0. The array uses 512 bytes when there is less than 255 voxels and 1024 bytes if more.</li>
<li>(B) dynamic array that contains the user data</li>
<li>(C) dynamic array that contains ids of free space into (B). Due to performance issue, the deleted voxels are not removed from (B), they are just marked as free. </li>
</ul>
<div class="image">
<img src="sparse_container.png" alt=""/>
</div>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md5"></a>
SidedContainer</h2>
<p>This structure is a wrapper on other voxel containers. It adds neighbor information inside voxels to allow the user to know the neighborhood of the voxels. The values of <a class="el" href="group___sided_container.html#ga090e1db43274bc833ca28e7d13ad47c7">SideEnum</a> are used to map the vicinity.</p>
<p><b>Warning</b>: Since it is only a wrapper, it have to be used with another voxel container (like <a class="el" href="structvoxomap_1_1_array_container.html">ArrayContainer</a> or <a class="el" href="classvoxomap_1_1_sparse_container.html">SparseContainer</a>)</p>
<p><br  />
 In this example, the <span style="color: #388bcf;">blue voxel</span> has 4 neighbors (at position x + 1, x - 1, y + 1 and z - 1).</p>
<p>So the side values are:</p><ul>
<li><span style="color: #388bcf;">Blue</span>: 39 = (XPOS | XNEG | YPOS | ZNEG) = (1 + 2 + 4 + 32)</li>
<li><span style="color: #d53939;">Red</span>: 2 = XNEG</li>
<li><span style="color: #c6ba03;">Yellow</span>: 8 = YNEG</li>
<li><span style="color: #9e3ad7;">Purple</span>: 1 = XPOS</li>
<li><span style="color: #6f6f6f;">Grey</span>: 16 = ZPOS</li>
</ul>
<div class="image">
<img src="sided_container.png" alt=""/>
</div>
<p><br  />
</p>
<hr  />
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Super Container Representation</h1>
<p>Super containers are similar to voxel containers but instead of containing voxels they contain voxel containers or super containers. Like voxel containers, the super containers contains 8x8x8 other containers and they fill all its octants/nodes. <br  />
 There is two implemented super containers, <a class="el" href="structvoxomap_1_1_array_super_container.html">ArraySuperContainer</a> and <a class="el" href="structvoxomap_1_1_sparse_super_container.html">SparseSuperContainer</a>. They have the same characteristics as their voxel container counterpart (<a href="#autotoc_md3">ArrayContainer</a> and <a href="#autotoc_md4">SparseContainer</a>). <br  />
 Like <a href="#autotoc_md2">Voxel Container</a>, this structure exists for improved performance, it allows to approach the performances of an array while keeping the advantage of the octree structure. <br  />
 </p><div class="image">
<img src="super_container.png" alt="" width="600px"/>
</div>
<p> <br  />
</p>
<hr  />
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Which container to use?</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Size of voxel  </th><th class="markdownTableHeadCenter">Number of voxels  </th><th class="markdownTableHeadCenter">ArrayContainer  </th><th class="markdownTableHeadCenter">SparseContainer   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1 byte  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">X  </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter" rowspan="2">&gt;= 2 bytes  </td><td class="markdownTableBodyCenter">&lt;= 255  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">X   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">&#160; &gt; 255  </td><td class="markdownTableBodyCenter">X  </td><td class="markdownTableBodyCenter"></td></tr>
</table>
<p><br  />
 This comparative table is just here to give you an idea of what to use.</p>
<p>It's just a simple calculation:</p><ul>
<li>ArrayContainer = voxel_size * 512</li>
<li>SparseContainer(&lt;= 255 voxels) = voxel_size * number_voxel + 512</li>
<li>SparseContainer(&gt; 255 voxels) = voxel_size * number_voxel + 1024 <br  />
</li>
</ul>
<hr  />
<p> <br  />
</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Benchmark Performance</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Continuous Benchmark</h2>
<p><b>Protocol:</b></p><ul>
<li>14M voxels</li>
<li>In area of size 256x256x256</li>
<li>One thread</li>
<li>Run on a Ryzen 3600 on Windows 10 system <br  />
 <div class="image">
<img src="contiguous.png" alt="" width="1000px"/>
</div>
 <br  />
 <div class="image">
<img src="sided_contiguous.png" alt="" width="1000px"/>
</div>
 <br  />
 </li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Random Benchmark</h2>
<p><b>Protocol:</b></p><ul>
<li>500K voxels</li>
<li>In area of size 512x512x512</li>
<li>One thread</li>
<li>Run on a Ryzen 3600 on Windows 10 system <br  />
 <div class="image">
<img src="random.png" alt="" width="1000px"/>
</div>
 <br  />
 <div class="image">
<img src="sided_random.png" alt="" width="1000px"/>
</div>
 </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
